<html>
<head>
<title> Placky - live network statistics - ver 0.1 </title>
<style>
.graph {
	width: 95%;
	height: 400px;
	font-size: 14px;
	line-height: 1.2em;
}
</style>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery.flot.min.js"></script>
<script id="source" language="javascript" type="text/javascript">
$(document).ready(function() {
	var options = {
		lines: { show: true },
		points: { show: false },
		xaxis: { mode: "time" },
		yaxis: { ticks: 10, position: "right" },
		legend: { placement: "sw" }
	};
	var rx_packets = [];
	var tx_packets = [];
	var rx_bytes = [];
	var tx_bytes = [];
	var iteration = 0;
	var interface;

	function fetchData() {
		++iteration;

		function onDataReceived(series) {
			$.merge(rx_packets, [series.rx_packets]);
			$.merge(tx_packets, [series.tx_packets]);
			$.merge(rx_bytes, [series.rx_bytes]);
			$.merge(tx_bytes, [series.tx_bytes]);

			$.plot("#packets-graph", [
					{ data: rx_packets, label: interface + ' incoming packets' },
					{ data: tx_packets, label: interface + ' outgoing packets' }
				], options);
			$.plot("#bytes-graph", [
					{ data: rx_bytes, label: interface + ' incoming Kbytes' },
					{ data: tx_bytes, label: interface + ' outgoing Kbytes' }
				], options);
		}

		$.ajax({
			url: "placky.pl",
			method: 'GET',
			dataType: 'json',
			success: onDataReceived
		});
		setTimeout(fetchData, 1000);
	}

	function getInterfaces() {
		function onListReceived(m) {
			for (i = 0; i < m.length; i++ ) {
				$('#iface').append($('<option>', { value: m[i], text: m[i] }));
			}
			interface = m[0];
		}

		$.ajax({
			url: 'placky.pl',
			method: 'GET',
			dataType: 'json',
			data: { a: "list" },
			success: onListReceived
		});
	}

	getInterfaces();
	fetchData();
});



</script>
</head>
<body>
	<div id="menu" class="menu">
	<form>
		Interfaces: <select name="iface" id="iface"></select>
	</form>
	</div>
	<div id="packets-graph" class="graph"></div>
	<div id="bytes-graph" class="graph"></div>
</body>
</html>
